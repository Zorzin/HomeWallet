@model HomeWallet.Models.ReceiptViewModels.CreateReceiptViewModel
@{
    ViewData["Title"] = "Create";
}

<script src="//ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js"></script>
<script src="//ajax.googleapis.com/ajax/libs/jqueryui/1.10.3/jquery-ui.min.js"></script>
<script src="~/js/chosen.jquery.js"></script>
<link rel="stylesheet" href="~/css/chosen.css">
<h2>Create</h2>

<form asp-action="Create">

    <div class="receiptcreate">
        <div class="receiptshop">
          <label>Date</label>
          <input type="date" asp-for="Date" class="form-control" placeholder="Date" />
          <span asp-validation-for="Date" class="text-danger"></span>
        </div>
        <div class="receiptdate">
          <label>Shop</label>
          <select data-placeholder="Select shop" asp-for="ShopID" class ="form-control chosen-single-select" asp-items="ViewBag.ShopID"></select>
        </div>
        <div class="receiptaddproduct">
          <button type="button" id="opendialogbutton" class="btn btn-success">Add product</button>
        </div>
        <div class="receiptproducts">

        </div>
        <div class="receiptbuttons">
            <a asp-action="Index" class="btn btn-danger">Cancel</a>
            <input type="submit" class="btn btn-success" value="Save"/>
        </div>
    </div>
</form>


<div id="productdialog"></div>
@section Scripts {
    @{await Html.RenderPartialAsync("_ValidationScriptsPartial");}
    <link rel="stylesheet" href="//code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css">
    <script src="@Url.Content("~/js/chosen.jquery.js")" type="text/javascript"></script>
    <script type="text/javascript">
      $(document)
          .ready(function () {
              $('.chosen-group-select').chosen();
              $('.chosen-single-select').chosen();
          });
    </script>
    <script>
      $(document).on('change', '#newproductcheckbox',function () {
        if ($(this).prop("checked")) {
          $('#newproduct').show();
        } else {
          $('#newproduct').hide();
        }
      });
    </script>

    <script>
      jQuery.noConflict();

        var dialog;
        $('#opendialogbutton').click(function () {
            dialog = $("#productdialog").dialog({
                autoOpen: true,
                modal: true,
                open: function() {
                    $(this).load('@Url.Action("AddProduct")');
                },
                buttons: {
                    "Add": function() {
                        AddProduct();
                    }
                }
            });
        });

        function AddProduct() {
            $.ajax({
                url: '@Url.Action("AddProduct")',
                type: 'POST',
                data: $("#addproductform").serialize(),
                success: function (data) {
                    $(".receiptproducts").append(data);
                    dialog.dialog('close');
                }
            });
        };

        $(document).on('click', '#removeproductbutton',
            function () {
                $(this).parent().remove();
            });

    </script>
}
